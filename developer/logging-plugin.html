<!DOCTYPE html>
<html>
<head>
  <title>Logging Plugin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Greg Schueler" />
  <meta name="date" content="June 5, 2013" />
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap-theme.min.css">

<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
jQuery(function(){ jQuery('table').addClass('table table-condensed table-responsive'); });
</script>
  <link rel="stylesheet" href="../style.css" type="text/css" />
</head>
<body data-spy="scroll" data-target=".toc-nav">
<nav class="navbar navbar-inverse navbar-static-top" role="navigation">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="container-fluid">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="http://rundeck.org/index.html">
      Rundeck
      <p class="small rd_version">Enables Self-Service Operations</p>
    </a>
  </div>
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">
    
    <li class="item about selected">
      <a href="http://rundeck.org/about.html">
        About
        <p class="small">News, Videos, Docs</p>
      </a>
    </li>
    <li class="item help">
      <a href="http://rundeck.org/help.html">
        Get Help
        <p class="small">IRC List Tracker</p>
      </a>
    </li>
    <li class="item plugins ">
      <a href="http://rundeck.org/plugins/index.html">
        Plugins
        <p class="small">Integrate Rundeck</p>
      </a>
    </li>
    <li class="item downloads  omega">
    <a href="http://rundeck.org/downloads.html">
      Download
      <p class="small rd_version">2.1.0</p>
      </a>
    </li>
    </ul>
    <form class="navbar-form navbar-left" role="search"  action="http://rundeck.org/search/">
      <div class="form-group">
        <input type="text" class="form-control" name="q" placeholder="Search">
      </div>
      <button type="submit" class="btn btn-default">Submit</button>
    </form>
  </div>
  </div>
</nav>

<div class="container top breadcrumb_holder">
<div class="row">
<div class="col-sm-6">
<ol class="breadcrumb top">

    
        <li><a href="../index.html">Rundeck Documentation (2.1.0)</a></li>
    
    
    <li ><a href="index.html">Plugin Developer Guide</a></li>
    <li class="active"><a href="logging-plugin.html">Logging Plugin</a></li>
</ol>
</div>
<div class="col-sm-6">
    <ul class="pager">
      <li class="previous"><a href="storage-plugin.html"><i class="glyphicon glyphicon-arrow-left"></i> Storage Plugin</a></li>
      <li class="next"><a href="resource-model-source-plugin.html">Resource Model Source Plugin <i class="glyphicon glyphicon-arrow-right"></i></a></li>
    </ul>
</div>
</div>
</div>
<div id="docbody">
<div class="container">
<div class="row">
<div class="col-sm-3 toc-nav">
<div class="nav">
<div id="TOC"
><ul
  ><li
    ><a href="#about"
      >About</a
      ><ul
      ><li
	><a href="#about-rundeck-logging"
	  >About Rundeck Logging</a
	  ></li
	></ul
      ></li
    ><li
    ><a href="#changes-since-rundeck-1.6"
      >Changes since Rundeck 1.6</a
      ></li
    ><li
    ><a href="#types-of-logging-plugins"
      >Types of Logging Plugins</a
      ></li
    ><li
    ><a href="#configuration"
      >Configuration</a
      ></li
    ><li
    ><a href="#plugin-development"
      >Plugin Development</a
      ><ul
      ><li
	><a href="#java-plugin-type"
	  >Java plugin type</a
	  ></li
	><li
	><a href="#groovy-plugin-type"
	  >Groovy plugin type</a
	  ></li
	></ul
      ></li
    ><li
    ><a href="#example-code"
      >Example code</a
      ></li
    ><li
    ><a href="#execution-context-data"
      >Execution Context Data</a
      ></li
    ><li
    ><a href="#streaminglogwriter"
      >StreamingLogWriter</a
      ><ul
      ><li
	><a href="#java-streaminglogwriter"
	  >Java StreamingLogWriter</a
	  ></li
	><li
	><a href="#groovy-streaminglogwriter"
	  >Groovy StreamingLogWriter</a
	  ></li
	></ul
      ></li
    ><li
    ><a href="#streaminglogreader"
      >StreamingLogReader</a
      ><ul
      ><li
	><a href="#java-streaminglogreader"
	  >Java StreamingLogReader</a
	  ></li
	><li
	><a href="#groovy-streaminglogreader"
	  >Groovy StreamingLogReader</a
	  ></li
	></ul
      ></li
    ><li
    ><a href="#executionfilestorage"
      >ExecutionFileStorage</a
      ><ul
      ><li
	><a href="#storage-behavior"
	  >Storage behavior</a
	  ></li
	><li
	><a href="#retrieval-behavior"
	  >Retrieval behavior</a
	  ></li
	><li
	><a href="#execution-file-availability"
	  >Execution File Availability</a
	  ></li
	><li
	><a href="#java-executionfilestorage"
	  >Java ExecutionFileStorage</a
	  ></li
	><li
	><a href="#groovy-executionfilestorage"
	  >Groovy ExecutionFileStorage</a
	  ></li
	></ul
      ></li
    ></ul
  ></div
>
</div>
</div>
<div class="col-sm-9">
<div class="page-header">
<h1 class="title">Logging Plugin</h1>
</div>
<div id="about"
><h2
  ><a href="#TOC"
    >About</a
    ></h2
  ><p
  >A Logging provider stores or forwards execution log data.</p
  ><div id="about-rundeck-logging"
  ><h3
    ><a href="#TOC"
      >About Rundeck Logging</a
      ></h3
    ><p
    >When Rundeck executes a Job or adhoc execution, it runs workflow steps across multiple nodes and channels all output from these steps into a log for the execution. This log contains the output from each step, as well as metadata about the context that the event occurred in, such as the node name, date stamp, and contextual data about the step being executed.</p
    ><p
    >This logging system consists of these components:</p
    ><ul
    ><li
      ><em
	>Streaming Log Writers</em
	> - One or more outputs for the log data</li
      ><li
      ><em
	>Streaming Log Reader</em
	> - One input for reading the log data</li
      ></ul
    ><p
    >When an execution starts, it writes log events to all outputs until it is done. When a user views the execution log in the Rundeck GUI, or accesses it via the API, the input component is used to read the log events for the specific Execution.</p
    ><p
    >Rundeck provides a built-in Reader and Writer, by writing the log output to a formatted file on disk, stored in the <code
      >var/logs</code
      > directory. This is the <em
      >Local File Log</em
      >.</p
    ><p
    >In addition, in Rundeck 2.0+, each execution generates a <em
      >state</em
      > file, which contains information about how each step and node executed. This file is also stored on disk.</p
    ><p
    >However local storage of log files is not always ideal, such as when deploying of Rundeck in a cloud environment where local disk storage could be ephemeral, or when clustering multiple Rundeck servers. In those cases, it would be useful to have a way to store the log file and state file somewhere else, and retrieve them when necessary.</p
    ><p
    >Rundeck has another component:</p
    ><ul
    ><li
      ><em
	>Execution File Storage</em
	> - A way of storing and retrieving file data in an external system</li
      ></ul
    ><p
    >Rundeck has a plugin mechanism for all three of these components, allowing the logging system and file storage system to be adapted to different needs.</p
    ><p
    >Log Events are written to all configured Writer plugins, as well as the <strong
      >Local File Log</strong
      > if not disabled:</p
    ><div class="figure"
    ><img src="../figures/log%20storage1.png" alt="Writer plugins"
       /><p class="caption"
      >Writer plugins</p
      ></div
    ><p
    >Events are read from either a Reader plugin, or the <strong
      >Local File Log</strong
      >:</p
    ><div class="figure"
    ><img src="../figures/log%20storage2.png" alt="Reader plugins"
       /><p class="caption"
      >Reader plugins</p
      ></div
    ><p
    >When the <strong
      >Local File Log</strong
      > is used, the logs can be asynchronously stored to a Storage plugin after they are completed. Later, the logs can be asynchronously retrieved via the Storage plugin to be used by the <strong
      >Local File Log</strong
      >:</p
    ><div class="figure"
    ><img src="../figures/log%20storage3.png" alt="Storage plugins"
       /><p class="caption"
      >Storage plugins</p
      ></div
    ><p
    >Here are some examples of how it can be used:</p
    ><ul
    ><li
      >replace the <strong
	>Local File Log</strong
	> entirely with another Reader and set of Writers</li
      ><li
      >duplicate all log output somewhere, in addition to using the <strong
	>Local File Log</strong
	></li
      ><li
      >Supplement the <strong
	>Local File Log</strong
	> with a secondary log file storage system, so that local files can be removed and restored as needed</li
      ></ul
    ></div
  ></div
><div id="changes-since-rundeck-1.6"
><h2
  ><a href="#TOC"
    >Changes since Rundeck 1.6</a
    ></h2
  ><p
  >In Rundeck 1.6, there was an <code
    >LogFileStorage</code
    > service and plugin system. In Rundeck 2.0+, this has been replaced by the <code
    >ExecutionFileStorage</code
    > service and plugin system.</p
  ><p
  >Any plugins written for Rundeck 1.6 will <em
    >not</em
    > work in Rundeck 2.0, and need to be updated to use the new mechanism.</p
  ></div
><div id="types-of-logging-plugins"
><h2
  ><a href="#TOC"
    >Types of Logging Plugins</a
    ></h2
  ><p
  >There are three types of plugins that can be created:</p
  ><ul
  ><li
    ><a href="#streaminglogwriter"
      >StreamingLogWriter</a
      > - provides a stream-like mechanism for writing log events (<a href="../javadoc/com/dtolabs/rundeck/core/logging/StreamingLogWriter.html"
      >javadoc</a
      >).</li
    ><li
    ><a href="#streaminglogreader"
      >StreamingLogReader</a
      > - provides a stream-like mechanism for reading log events (<a href="../javadoc/com/dtolabs/rundeck/core/logging/StreamingLogReader.html"
      >javadoc</a
      >).</li
    ><li
    ><a href="#executionfilestorage"
      >ExecutionFileStorage</a
      > - provides a way to both store and retrieve entire log files and execution state files (<a href="../javadoc/com/dtolabs/rundeck/core/logging/ExecutionFileStorage.html"
      >javadoc</a
      >).</li
    ></ul
  ></div
><div id="configuration"
><h2
  ><a href="#TOC"
    >Configuration</a
    ></h2
  ><p
  >See the chapter <a href="../plugins-user-guide/configuring.html#logging-plugin-configuration"
    >Plugins User Guide - Configuring - Logging</a
    >.</p
  ></div
><div id="plugin-development"
><h2
  ><a href="#TOC"
    >Plugin Development</a
    ></h2
  ><p
  >Rundeck supports two development modes for Logging plugins:</p
  ><ol style="list-style-type: decimal;"
  ><li
    >Java-based development deployed as a Jar file.</li
    ><li
    >Groovy-based deployed as a single <code
      >.groovy</code
      > script.</li
    ></ol
  ><blockquote
  ><p
    >Note, &quot;script-based&quot; plugins (shell scripts, that is) are not supported.</p
    ></blockquote
  ><div id="java-plugin-type"
  ><h3
    ><a href="#TOC"
      >Java plugin type</a
      ></h3
    ><p
    >Java-based plugins can be developed just as any other Rundeck plugin, as described in the chapter <a href="plugin-development.html#java-plugin-development"
      >Plugin Development - Java Plugin Development</a
      >.</p
    ><p
    >Your plugin class should implement the appropriate Java interface as described in the section for that plugin:</p
    ><ul
    ><li
      ><a href="#streaminglogwriter"
	>StreamingLogWriter</a
	></li
      ><li
      ><a href="#streaminglogreader"
	>StreamingLogReader</a
	></li
      ><li
      ><a href="#executionfilestorage"
	>ExecutionFileStorage</a
	></li
      ></ul
    ><p
    >To define configuration properties for your plugin, you use the same mechanisms as for Workflow Steps, described under the chapter <a href="plugin-annotations.html#plugin-description"
      >Plugin Annotations - Plugin Descriptions</a
      >.</p
    ><p
    >The simplest way to do this is to use <a href="plugin-annotations.html#plugin-properties"
      >Plugin Annotations - Plugin Properties</a
      >.</p
    ></div
  ><div id="groovy-plugin-type"
  ><h3
    ><a href="#TOC"
      >Groovy plugin type</a
      ></h3
    ><p
    >The Groovy plugin development method for Loggig Plugins is similar to <a href="notification-plugin.html#groovy-plugin-type"
      >Notification Plugin - Groovy Plugins</a
      >.</p
    ><p
    >Create a Groovy script, and define your plugin by calling the <code
      >rundeckPlugin</code
      > method, and pass it both the Class of the type of plugin, and a Closure used to build the plugin object.</p
    ><pre class="sourceCode java"
    ><code
      ><span class="Keyword"
	>import</span
	><span class="Normal NormalText"
	> com.dtolabs.rundeck.plugins.logging.StreamingLogWriterPlugin</span
	><br
	 /><span class="Function"
	>rundeckPlugin</span
	><span class="Normal Symbol"
	>(</span
	><span class="Normal NormalText"
	>StreamingLogWriterPlugin</span
	><span class="Normal Symbol"
	>){</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>//plugin definition goes here...</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ></div
  ></div
><div id="example-code"
><h2
  ><a href="#TOC"
    >Example code</a
    ></h2
  ><p
  >See the source directory <code
    >examples/example-groovy-log-plugins</code
    > for examples of all three provider types written in Groovy.</p
  ><ul
  ><li
    >On github: <a href="https://github.com/rundeck/rundeck/tree/development/examples/example-groovy-log-plugins"
      >example-groovy-log-plugins</a
      ></li
    ></ul
  ><p
  >See the source directory <code
    >examples/example-java-logging-plugins</code
    > for Java examples.</p
  ><ul
  ><li
    >On github: <a href="https://github.com/rundeck/rundeck/tree/development/examples/example-java-logging-plugins"
      >example-java-logging-plugins</a
      ></li
    ></ul
  ></div
><div id="execution-context-data"
><h2
  ><a href="#TOC"
    >Execution Context Data</a
    ></h2
  ><p
  >All three plugin types are given a Map of Execution &quot;context data&quot;. This is a dataset with information about the Execution that produced the log events.</p
  ><p
  >This data map is the same as the &quot;Job context variables&quot; available when you execute a job or adhoc script, as described in the chapter <a href="../manual/jobs.html#context-variables"
    >Job Workflows - Context Variables</a
    >.</p
  ><p
  >Note that the Map keys will not start with <code
    >job.</code
    >, simply use the variable name, such as <code
    >execid</code
    >.</p
  ><p
  >In addition, for ExecutionFileStorage plugins, another map entry named <code
    >filetype</code
    > will be specified, which indicates which type of file is being stored. You need to use this filetype as part of the identifier for storing or retrieving the file.</p
  ></div
><div id="streaminglogwriter"
><h2
  ><a href="#TOC"
    >StreamingLogWriter</a
    ></h2
  ><p
  >The <code
    >StreamingLogWriter</code
    > (<a href="../javadoc/com/dtolabs/rundeck/core/logging/StreamingLogWriter.html"
    >javadoc</a
    >) system receives log events from an execution and writes them somewhere.</p
  ><div id="java-streaminglogwriter"
  ><h3
    ><a href="#TOC"
      >Java StreamingLogWriter</a
      ></h3
    ><p
    >Create a Java class that implements the interface <a href="../javadoc/com/dtolabs/rundeck/plugins/logging/StreamingLogWriterPlugin.html"
      >StreamingLogWriterPlugin</a
      >:</p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> Plugin interface for streaming log writers<br
	 /> */<br
	 /><span class="Keyword"
	>public</span
	><span class="Normal NormalText"
	> </span
	><span class="Keyword"
	>interface</span
	><span class="Normal NormalText"
	> StreamingLogWriterPlugin </span
	><span class="Keyword"
	>extends</span
	><span class="Normal NormalText"
	> StreamingLogWriter </span
	><span class="Normal Symbol"
	>{</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	>/**<br
	 />     <span class="Normal Symbol"
	>*</span
	> Sets the execution context information for the log information <br
	 />     <span class="Normal Symbol"
	>*</span
	> being written<span class="Normal Symbol"
	>,</span
	> will be called prior to other<br
	 />     <span class="Normal Symbol"
	>*</span
	> methods {@link <span class="Normal NormalText"
	>#</span
	>openStream<span class="Normal Symbol"
	>()</span
	>}<br
	 />     <span class="Normal Symbol"
	>*</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>param context<br
	 />     */<br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Keyword"
	>public</span
	><span class="Normal NormalText"
	> </span
	><span class="DataType DataType"
	>void</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>initialize</span
	><span class="Normal Symbol"
	>(</span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal Symbol"
	>&lt;</span
	><span class="Normal Java15"
	>String</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Symbol"
	>?</span
	><span class="Normal NormalText"
	> </span
	><span class="Keyword"
	>extends</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Object</span
	><span class="Normal Symbol"
	>&gt;</span
	><span class="Normal NormalText"
	> context</span
	><span class="Normal Symbol"
	>);</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    >This extends <code
      >StreamingLogWriter</code
      >:</p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> writes log entries in a streaming manner<br
	 /> */<br
	 /><span class="Keyword"
	>public</span
	><span class="Normal NormalText"
	> </span
	><span class="Keyword"
	>interface</span
	><span class="Normal NormalText"
	> StreamingLogWriter </span
	><span class="Normal Symbol"
	>{</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	>/**<br
	 />     <span class="Normal Symbol"
	>*</span
	> Open a stream<span class="Normal Symbol"
	>,</span
	> called before addEvent is called<br
	 />     */<br
	 /><span class="Normal NormalText"
	>    </span
	><span class="DataType DataType"
	>void</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>openStream</span
	><span class="Normal Symbol"
	>()</span
	><span class="Normal NormalText"
	> </span
	><span class="Keyword"
	>throws</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>IOException</span
	><span class="Normal Symbol"
	>;</span
	><br
	 /><br
	 /><span class="Normal NormalText"
	>    </span
	>/**<br
	 />     <span class="Normal Symbol"
	>*</span
	> Add a new event<br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>param event<br
	 />     */<br
	 /><span class="Normal NormalText"
	>    </span
	><span class="DataType DataType"
	>void</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>addEvent</span
	><span class="Normal Symbol"
	>(</span
	><span class="Normal NormalText"
	>LogEvent event</span
	><span class="Normal Symbol"
	>);</span
	><br
	 /><br
	 /><span class="Normal NormalText"
	>    </span
	>/**<br
	 />     <span class="Normal Symbol"
	>*</span
	> Close the stream<span class="Normal Symbol"
	>.</span
	><br
	 />     */<br
	 /><span class="Normal NormalText"
	>    </span
	><span class="DataType DataType"
	>void</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>close</span
	><span class="Normal Symbol"
	>();</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    >The plugin is used in this manner:</p
    ><ol style="list-style-type: decimal;"
    ><li
      >When the plugin is instantiated, any configuration properties defined that have values to be resolved are set on the plugin instance</li
      ><li
      >the <code
	>initialize</code
	> method is called with a map of <a href="#execution-context-data"
	>contextual data</a
	> about the execution</li
      ><li
      >When an execution starts, the <code
	>openStream</code
	> method is called</li
      ><li
      >For every log event that is emitted by the execution, each plugin's <code
	>addEvent</code
	> is called with the event</li
      ><li
      >After execution finishes, <code
	>close</code
	> is called.</li
      ></ol
    ></div
  ><div id="groovy-streaminglogwriter"
  ><h3
    ><a href="#TOC"
      >Groovy StreamingLogWriter</a
      ></h3
    ><p
    >Create a groovy script that calls the <code
      >rundeckPlugin</code
      > method and passes the <code
      >StreamingLogWriterPlugin</code
      > as the type of plugin:</p
    ><pre class="sourceCode java"
    ><code
      ><span class="Keyword"
	>import</span
	><span class="Normal NormalText"
	> com.dtolabs.rundeck.plugins.logging.StreamingLogWriterPlugin</span
	><br
	 /><span class="Function"
	>rundeckPlugin</span
	><span class="Normal Symbol"
	>(</span
	><span class="Normal NormalText"
	>StreamingLogWriterPlugin</span
	><span class="Normal Symbol"
	>){</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>//plugin definition</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    >To define metadata about your plugin, and configuration properties, see the <a href="notification-plugin.html#definition"
      >Notification Plugin - Groovy Notification Plugins - DSL - Definition</a
      > chapter.</p
    ><p
    >Define these closures inside your definition:</p
    ><p
    ><code
      >open</code
      ></p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> The <span class="String"
	>&quot;open&quot;</span
	> closure is called to open the stream for writing events<span class="Normal Symbol"
	>.</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> It is passed two map arguments<span class="Normal Symbol"
	>,</span
	> the execution data<span class="Normal Symbol"
	>,</span
	> and the plugin configuration data<span class="Normal Symbol"
	>.</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> It should return a Map containing the stream context<span class="Normal Symbol"
	>,</span
	> which will be passed back for later<br
	 /> <span class="Normal Symbol"
	>*</span
	> calls to the <span class="String"
	>&quot;addEvent&quot;</span
	> closure<span class="Normal Symbol"
	>.</span
	><br
	 /> */<br
	 /><span class="Normal NormalText"
	>open </span
	><span class="Normal Symbol"
	>{</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> execution</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> config </span
	><span class="Normal Symbol"
	>-&gt;</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>//open a stream for writing</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>//return a map containing any context you want to maintain</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Normal Symbol"
	>[</span
	><span class="Normal NormalText"
	>mycounter</span
	><span class="Normal Symbol"
	>:</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Symbol"
	>.</span
	><span class="Normal Symbol"
	>.</span
	><span class="Normal Symbol"
	>.</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> mystream</span
	><span class="Normal Symbol"
	>:</span
	><span class="Normal NormalText"
	> </span
	><span class="Keyword"
	>... </span
	><span class="Normal Symbol"
	>]</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    ><code
      >addEvent</code
      ></p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> <span class="String"
	>&quot;addEvent&quot;</span
	> closure is called to append a new event to the stream<span class="Normal Symbol"
	>.</span
	>  <br
	 /> <span class="Normal Symbol"
	>*</span
	> It is passed the Map of stream context created in the <span class="String"
	>&quot;open&quot;</span
	> closure<span class="Normal Symbol"
	>,</span
	> and a LogEvent<br
	 /> <span class="Normal Symbol"
	>*</span
	> <br
	 /> */<br
	 /><span class="Normal NormalText"
	>addEvent </span
	><span class="Normal Symbol"
	>{</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> context</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> LogEvent event</span
	><span class="Normal Symbol"
	>-&gt;</span
	><br
	 /><span class="Normal NormalText"
	>   </span
	><span class="Comment"
	>// write the event to my stream</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    ><code
      >close</code
      ></p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> <span class="String"
	>&quot;close&quot;</span
	> closure is called to end writing to the stream<span class="Normal Symbol"
	>.</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> In this example we don<span class="Normal NormalText"
	>'</span
	>t declare any arguments<span class="Normal Symbol"
	>,</span
	> but an implicit <br
	 /> <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>'</span
	>context<span class="Normal NormalText"
	>'</span
	> variable is available with the stream context data<span class="Normal Symbol"
	>.</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> <br
	 /> */<br
	 /><span class="Normal NormalText"
	>close </span
	><span class="Normal Symbol"
	>{</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> context </span
	><span class="Normal Symbol"
	>-&gt;</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>// close my stream</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    >The plugin is used in this manner:</p
    ><ol style="list-style-type: decimal;"
    ><li
      >When an execution starts, the <code
	>open</code
	> closure is called with both the <a href="#execution-context-data"
	>contextual data</a
	> about the execution, and any configuration property values. The returned context map is kept to pass to later calls</li
      ><li
      >For every log event that is emitted by the execution, each plugin's <code
	>addEvent</code
	> is called with the event and the context map created by <code
	>open</code
	></li
      ><li
      >After execution finishes, <code
	>close</code
	> is called with the context map.</li
      ></ol
    ></div
  ></div
><div id="streaminglogreader"
><h2
  ><a href="#TOC"
    >StreamingLogReader</a
    ></h2
  ><p
  >The <code
    >StreamingLogReader</code
    > system reads log events from somewhere for a specific execution and returns them in an iterator-like fashion. Readers must also support an &quot;offset&quot;, allowing the event stream to resume from some index within the stream. These offset indices can be opaque to Rundeck (they could correspond to bytes, or event number, it is up to the plugin). The plugin is expected to report an offset value when reading events, and be able to resume from a previously reported offset value.</p
  ><p
  >Additionally, these plugins should be able to report a <code
    >totalSize</code
    > (in an opaque manner), and a <code
    >lastModified</code
    > timestamp, indicating the last log event timestamp that was received.</p
  ><div id="java-streaminglogreader"
  ><h3
    ><a href="#TOC"
      >Java StreamingLogReader</a
      ></h3
    ><p
    >Create a Java class that implements the interface <a href="../javadoc/com/dtolabs/rundeck/plugins/logging/StreamingLogReaderPlugin.html"
      >StreamingLogReaderPlugin</a
      >:</p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> Plugin interface for streaming log readers<br
	 /> */<br
	 /><span class="Keyword"
	>public</span
	><span class="Normal NormalText"
	> </span
	><span class="Keyword"
	>interface</span
	><span class="Normal NormalText"
	> StreamingLogReaderPlugin </span
	><span class="Keyword"
	>extends</span
	><span class="Normal NormalText"
	> StreamingLogReader </span
	><span class="Normal Symbol"
	>{</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	>/**<br
	 />     <span class="Normal Symbol"
	>*</span
	> Sets the execution context information for the log information <br
	 />     <span class="Normal Symbol"
	>*</span
	> being requested<span class="Normal Symbol"
	>,</span
	> will be called<br
	 />     <span class="Normal Symbol"
	>*</span
	> prior to other methods {@link <span class="Normal NormalText"
	>#</span
	>openStream<span class="Normal Symbol"
	>(</span
	>Long<span class="Normal Symbol"
	>)</span
	>}<span class="Normal Symbol"
	>,</span
	> and must return <br
	 />     <span class="Normal Symbol"
	>*</span
	> true to indicate the stream is ready to be open<span class="Normal Symbol"
	>,</span
	> false otherwise<span class="Normal Symbol"
	>.</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>param context execution context data<br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>return true if the stream is ready to open<br
	 />     */<br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Keyword"
	>public</span
	><span class="Normal NormalText"
	> </span
	><span class="DataType DataType"
	>boolean</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>initialize</span
	><span class="Normal Symbol"
	>(</span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal Symbol"
	>&lt;</span
	><span class="Normal Java15"
	>String</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Symbol"
	>?</span
	><span class="Normal NormalText"
	> </span
	><span class="Keyword"
	>extends</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Object</span
	><span class="Normal Symbol"
	>&gt;</span
	><span class="Normal NormalText"
	> context</span
	><span class="Normal Symbol"
	>);</span
	><br
	 /><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    >This extends the interface <a href="../javadoc/com/dtolabs/rundeck/core/logging/StreamingLogReader.html"
      >StreamingLogReader</a
      >:</p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	>  Reads log events in a streaming manner<span class="Normal Symbol"
	>,</span
	> and supports resuming from a specified offset<span class="Normal Symbol"
	>.</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	>  <span class="Normal NormalText"
	>@</span
	>see LogEventIterator<br
	 /> <span class="Normal Symbol"
	>*</span
	>  <span class="Normal NormalText"
	>@</span
	>see OffsetIterator<br
	 /> <span class="Normal Symbol"
	>*</span
	>  <span class="Normal NormalText"
	>@</span
	>see Closeable<br
	 /> <span class="Normal Symbol"
	>*</span
	>  <span class="Normal NormalText"
	>@</span
	>see CompletableIterator<br
	 /> */<br
	 /><span class="Keyword"
	>public</span
	><span class="Normal NormalText"
	> </span
	><span class="Keyword"
	>interface</span
	><span class="Normal NormalText"
	> StreamingLogReader </span
	><span class="Keyword"
	>extends</span
	><span class="Normal NormalText"
	> LogEventIterator</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Closeable</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Symbol"
	>{</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	>/**<br
	 />     <span class="Normal Symbol"
	>*</span
	> Read log entries starting at the specified offset<br
	 />     <span class="Normal Symbol"
	>*</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>param offset<br
	 />     <span class="Normal Symbol"
	>*</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>return<br
	 />     */<br
	 /><span class="Normal NormalText"
	>    </span
	><span class="DataType DataType"
	>void</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>openStream</span
	><span class="Normal Symbol"
	>(</span
	><span class="Normal Java15"
	>Long</span
	><span class="Normal NormalText"
	> offset</span
	><span class="Normal Symbol"
	>)</span
	><span class="Normal NormalText"
	> </span
	><span class="Keyword"
	>throws</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>IOException</span
	><span class="Normal Symbol"
	>;</span
	><br
	 /><br
	 /><span class="Normal NormalText"
	>    </span
	>/**<br
	 />     <span class="Normal Symbol"
	>*</span
	> Return the total size<br
	 />     <span class="Normal Symbol"
	>*</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>return<br
	 />     */<br
	 /><span class="Normal NormalText"
	>    </span
	><span class="DataType DataType"
	>long</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>getTotalSize</span
	><span class="Normal Symbol"
	>();</span
	><br
	 /><br
	 /><span class="Normal NormalText"
	>    </span
	>/**<br
	 />     <span class="Normal Symbol"
	>*</span
	> Return the last modification time of the log <br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal Symbol"
	>(</span
	>e<span class="Normal Symbol"
	>.</span
	>g<span class="Normal Symbol"
	>.</span
	> last log entry time<span class="Normal Symbol"
	>,</span
	> or null if not modified<span class="Normal Symbol"
	>)</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>return<br
	 />     */<br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Normal Java15"
	>Date</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>getLastModified</span
	><span class="Normal Symbol"
	>();</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    >Additional methods that must be implemented from super-interfaces:</p
    ><pre class="sourceCode java"
    ><code
      ><span class="Comment"
	>//from LogEventIterator</span
	><br
	 /><span class="Normal NormalText"
	>LogEvent </span
	><span class="Function"
	>next</span
	><span class="Normal Symbol"
	>();</span
	><br
	 /><span class="DataType DataType"
	>boolean</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>hasNext</span
	><span class="Normal Symbol"
	>();</span
	><br
	 /><span class="DataType DataType"
	>void</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>remove</span
	><span class="Normal Symbol"
	>();</span
	><span class="Normal NormalText"
	> </span
	><span class="Comment"
	>//unused</span
	><br
	 /><br
	 />/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> Returns the current opaque offset within the underlying data stream<br
	 /> <span class="Normal Symbol"
	>*</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>return<br
	 /> */<br
	 /><span class="DataType DataType"
	>long</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>getOffset</span
	><span class="Normal Symbol"
	>();</span
	><span class="Normal NormalText"
	> </span
	><span class="Comment"
	>//from OffsetIterator</span
	><br
	 /><br
	 />/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> Return true if the underlying source is completely exhausted<span class="Normal Symbol"
	>,</span
	> whether<br
	 /> <span class="Normal Symbol"
	>*</span
	> or not there are any items to produce <span class="Normal Symbol"
	>(</span
	>may return false even if {@link Iterator<span class="Normal NormalText"
	>#</span
	>hasNext<span class="Normal Symbol"
	>()</span
	>} returns false<span class="Normal Symbol"
	>).</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>return true if underlying iteration source is exhasuted<br
	 /> */<br
	 /><span class="DataType DataType"
	>boolean</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>isComplete</span
	><span class="Normal Symbol"
	>();</span
	><span class="Normal NormalText"
	> </span
	><span class="Comment"
	>//from CompletableIterator</span
	><br
	 /></code
      ></pre
    ><p
    >The plugin is used in this manner:</p
    ><ol style="list-style-type: decimal;"
    ><li
      >When the plugin is instantiated, any configuration properties defined that have values to be resolved are set on the plugin instance</li
      ><li
      >the <code
	>initialize</code
	> method is called with a map of <a href="#execution-context-data"
	>contextual data</a
	> about the execution, if the method returns false, then clients are told that the log stream is pending.</li
      ><li
      >the <code
	>getLastModified</code
	> method may be called, to determine if there are new events since a read sequence</li
      ><li
      >The <code
	>openStream</code
	> method is called, possibly with an offset larger than 0, which indicates the event stream should begin at the specified offset</li
      ><li
      >The <code
	>java.util.Iterator</code
	> methods will be called to iterate all available LogEvents</li
      ><li
      >The <code
	>isComplete</code
	> method will be called to determine if the log output is complete, or may contain more entries later.</li
      ><li
      >The <code
	>getOffset</code
	> method will be called to record the last offset read.</li
      ><li
      >Finally, <code
	>close</code
	> is called.</li
      ></ol
    ><p
    >Rundeck uses this interface to read the log events to display in the GUI, or send out via its API. It uses the <code
      >offset</code
      >, as well as <code
      >lastModified</code
      >, to resume reading the log from a certain point, and to check whether there is more data since the last time it was read.</p
    ><p
    >The implementation of the <code
      >isComplete</code
      > method is important, because it signals to Rundeck that all log events for the stream have been read and no more are expected to be available. To be clear, this differs from the <code
      >java.util.Iterator#hasNext()</code
      > method, which returns true if any events are actually available. <code
      >isComplete</code
      > should return false until no more events will ever be available.</p
    ><p
    >If you are developing a <code
      >StreamingLogWriter</code
      > in conjuction with a <code
      >StreamingLogReader</code
      >, keep in mind that the writer's <code
      >close</code
      > method will be called to indicate the end of the stream, which would be reflected on the reader side by <code
      >isComplete</code
      > returning true.</p
    ></div
  ><div id="groovy-streaminglogreader"
  ><h3
    ><a href="#TOC"
      >Groovy StreamingLogReader</a
      ></h3
    ><p
    >Create a groovy script that calls the <code
      >rundeckPlugin</code
      > method and passes the <code
      >StreamingLogReaderPlugin</code
      > as the type of plugin:</p
    ><pre class="sourceCode java"
    ><code
      ><span class="Keyword"
	>import</span
	><span class="Normal NormalText"
	> com.dtolabs.rundeck.plugins.logging.StreamingLogReaderPlugin</span
	><br
	 /><span class="Function"
	>rundeckPlugin</span
	><span class="Normal Symbol"
	>(</span
	><span class="Normal NormalText"
	>StreamingLogReaderPlugin</span
	><span class="Normal Symbol"
	>){</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>//plugin definition</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    >To define metadata about your plugin, and configuration properties, see the <a href="notification-plugin.html#definition"
      >Notification Plugin - Groovy Notification Plugins - DSL - Definition</a
      > chapter.</p
    ><p
    >Define these closures inside your definition:</p
    ><p
    ><code
      >info</code
      ></p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> The <span class="Normal NormalText"
	>'</span
	>info<span class="Normal NormalText"
	>'</span
	> closure is called to retrieve some metadata about the stream<span class="Normal Symbol"
	>,</span
	> <br
	 /> <span class="Normal Symbol"
	>*</span
	> such as whether it is available to read<span class="Normal Symbol"
	>,</span
	> totalSize of the content<span class="Normal Symbol"
	>,</span
	> and last<br
	 /> <span class="Normal Symbol"
	>*</span
	>  modification time<br
	 /> <span class="Normal Symbol"
	>*</span
	> <br
	 /> <span class="Normal Symbol"
	>*</span
	> It should return a Map containing these two entries<span class="Normal Symbol"
	>:</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	>  <span class="Normal NormalText"
	>`</span
	>ready<span class="Normal NormalText"
	>`</span
	> <span class="Normal Symbol"
	>:</span
	> a boolean indicating whether <span class="Normal NormalText"
	>'</span
	>open<span class="Normal NormalText"
	>'</span
	> will work<br
	 /> <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>`</span
	>lastModified<span class="Normal NormalText"
	>`</span
	><span class="Normal Symbol"
	>:</span
	> Long <span class="Normal Symbol"
	>(</span
	>unix epoch<span class="Normal Symbol"
	>)</span
	> or Date indicating last modification of the log<br
	 /> <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>`</span
	>totalSize<span class="Normal NormalText"
	>`</span
	><span class="Normal Symbol"
	>:</span
	> Long indicating total size of the log<span class="Normal Symbol"
	>,</span
	> it doesn<span class="Normal NormalText"
	>'</span
	>t have to indicate bytes<span class="Normal Symbol"
	>,</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	>     merely a measurement of total data size<br
	 /> */<br
	 /><span class="Normal NormalText"
	>info </span
	><span class="Normal Symbol"
	>{</span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> execution</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> configuration</span
	><span class="Normal Symbol"
	>-&gt;</span
	><br
	 /><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>//return map containing metadata about the stream</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>// it SHOULD contain these two elements:</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Normal Symbol"
	>[</span
	><br
	 /><span class="Normal NormalText"
	>        lastModified</span
	><span class="Normal Symbol"
	>:</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>determineLastModified</span
	><span class="Normal Symbol"
	>(),</span
	><br
	 /><span class="Normal NormalText"
	>        totalSize</span
	><span class="Normal Symbol"
	>:</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>determineDataSize</span
	><span class="Normal Symbol"
	>(),</span
	><br
	 /><span class="Normal NormalText"
	>        ready</span
	><span class="Normal Symbol"
	>:</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>isReady</span
	><span class="Normal Symbol"
	>()</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Normal Symbol"
	>]</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    ><code
      >open</code
      ></p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> The <span class="Normal NormalText"
	>`</span
	>open<span class="Normal NormalText"
	>`</span
	> closure is called to begin reading events from the stream<span class="Normal Symbol"
	>.</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> It is passed the execution data<span class="Normal Symbol"
	>,</span
	> the plugin configuration<span class="Normal Symbol"
	>,</span
	> and an offset<span class="Normal Symbol"
	>.</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> It should return a Map containing any context to store between calls<span class="Normal Symbol"
	>.</span
	><br
	 /> */<br
	 /><span class="Normal NormalText"
	>open </span
	><span class="Normal Symbol"
	>{</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> execution</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> configuration</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="DataType DataType"
	>long</span
	><span class="Normal NormalText"
	> offset </span
	><span class="Normal Symbol"
	>-&gt;</span
	><br
	 /><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>//return map of context data for your plugin to reuse later,</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Normal Symbol"
	>[</span
	><br
	 /><span class="Normal NormalText"
	>        myfile</span
	><span class="Normal Symbol"
	>:</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Symbol"
	>.</span
	><span class="Normal Symbol"
	>.</span
	><span class="Normal Symbol"
	>.</span
	><span class="Normal Symbol"
	>,</span
	><br
	 /><span class="Normal NormalText"
	>        mycounter</span
	><span class="Normal Symbol"
	>:.</span
	><span class="Normal Symbol"
	>.</span
	><span class="Normal Symbol"
	>.</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Normal Symbol"
	>]</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    ><code
      >next</code
      ></p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> Next is called to produce the next event<span class="Normal Symbol"
	>,</span
	> it should return a Map<br
	 /> <span class="Normal Symbol"
	>*</span
	> containing<span class="Normal Symbol"
	>:</span
	> <span class="Normal Symbol"
	>[</span
	>event<span class="Normal Symbol"
	>:</span
	> <span class="Normal Symbol"
	>(</span
	>event data<span class="Normal Symbol"
	>),</span
	> offset<span class="Normal Symbol"
	>:</span
	> <span class="Normal Symbol"
	>(</span
	>next offset<span class="Normal Symbol"
	>),</span
	> complete<span class="Normal Symbol"
	>:</span
	> <span class="Normal Symbol"
	>(</span
	>true<span class="Normal Symbol"
	>/</span
	>false<span class="Normal Symbol"
	>)].</span
	>  <br
	 /> <span class="Normal Symbol"
	>*</span
	> The event data can be a LogEvent<span class="Normal Symbol"
	>,</span
	> or a Map containing<span class="Normal Symbol"
	>:</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> <span class="Normal Symbol"
	>[</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> message<span class="Normal Symbol"
	>:</span
	> <span class="Normal Symbol"
	>(</span
	>String<span class="Normal Symbol"
	>),</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> loglevel<span class="Normal Symbol"
	>:</span
	> <span class="Normal Symbol"
	>(</span
	>String or LogLevel<span class="Normal Symbol"
	>),</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> datetime<span class="Normal Symbol"
	>:</span
	> <span class="Normal Symbol"
	>(</span
	>long or Date<span class="Normal Symbol"
	>),</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> eventType<span class="Normal Symbol"
	>:</span
	> <span class="Normal Symbol"
	>(</span
	>String<span class="Normal Symbol"
	>),</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> metadata<span class="Normal Symbol"
	>:</span
	> <span class="Normal Symbol"
	>(</span
	>Map<span class="Normal Symbol"
	>),</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> <span class="Normal Symbol"
	>]</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>`</span
	>complete<span class="Normal NormalText"
	>`</span
	> should be true if no more events will ever be available<span class="Normal Symbol"
	>.</span
	><br
	 /> */<br
	 /><span class="Normal NormalText"
	>next </span
	><span class="Normal Symbol"
	>{</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> context</span
	><span class="Normal Symbol"
	>-&gt;</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> value</span
	><span class="Normal Symbol"
	>=</span
	><span class="Keyword"
	>null</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="DataType DataType"
	>boolean</span
	><span class="Normal NormalText"
	> complete</span
	><span class="Normal Symbol"
	>=</span
	><span class="Keyword"
	>false</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="DataType DataType"
	>long</span
	><span class="Normal NormalText"
	> offset</span
	><span class="Normal Symbol"
	>=.</span
	><span class="Normal Symbol"
	>.</span
	><span class="Normal Symbol"
	>.</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Keyword"
	>try</span
	><span class="Normal Symbol"
	>{</span
	><br
	 /><span class="Normal NormalText"
	>        value </span
	><span class="Normal Symbol"
	>=</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>readNextValue</span
	><span class="Normal Symbol"
	>(.</span
	><span class="Normal Symbol"
	>.</span
	><span class="Normal Symbol"
	>.</span
	><span class="Normal Symbol"
	>)</span
	><br
	 /><span class="Normal NormalText"
	>        complete </span
	><span class="Normal Symbol"
	>=</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>isComplete</span
	><span class="Normal Symbol"
	>(.</span
	><span class="Normal Symbol"
	>.</span
	><span class="Normal Symbol"
	>)</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Normal Symbol"
	>}</span
	><span class="Keyword"
	>catch</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Symbol"
	>(</span
	><span class="Normal NormalText"
	>SomeException e</span
	><span class="Normal Symbol"
	>){</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Normal Symbol"
	>}</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>//event can be a Map, or a LogEvent</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Keyword"
	>return</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Symbol"
	>[</span
	><span class="Normal NormalText"
	>event</span
	><span class="Normal Symbol"
	>:</span
	><span class="Normal NormalText"
	>event</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> offset</span
	><span class="Normal Symbol"
	>:</span
	><span class="Normal NormalText"
	>offset</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> complete</span
	><span class="Normal Symbol"
	>:</span
	><span class="Normal NormalText"
	>complete</span
	><span class="Normal Symbol"
	>]</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    ><code
      >close</code
      ></p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> Close is called to finish the read stream<br
	 /> */<br
	 /><span class="Normal NormalText"
	>close</span
	><span class="Normal Symbol"
	>{</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> context</span
	><span class="Normal Symbol"
	>-&gt;</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>//perform any close action</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    >The plugin is used in this manner:</p
    ><ol style="list-style-type: decimal;"
    ><li
      >The <code
	>info</code
	> closure is called to determine the <code
	>lastModified</code
	> and <code
	>totalSize</code
	>.</li
      ><li
      >The <code
	>open</code
	> closure is called with both the <a href="#execution-context-data"
	>contextual data</a
	> about the execution, and any configuration property values, and the expected read offset</li
      ><li
      >The <code
	>next</code
	> closure is called repeatedly, until the result <code
	>event</code
	> entry is null, or <code
	>complete</code
	> is true. The <code
	>offset</code
	> value is reported to the client.</li
      ><li
      >The <code
	>close</code
	> closure is called with the context map.</li
      ></ol
    ></div
  ></div
><div id="executionfilestorage"
><h2
  ><a href="#TOC"
    >ExecutionFileStorage</a
    ></h2
  ><p
  >The <code
    >ExecutionFileStorage</code
    > system is asked to store and retrieve entire log files and state files for a specific execution.</p
  ><p
  >The Java interface for these plugins is <a href="../javadoc/com/dtolabs/rundeck/plugins/logging/ExecutionFileStoragePlugin.html"
    >ExecutionFileStoragePlugin</a
    >.</p
  ><p
  >Exection file storage allows Rundeck to store the files elsewhere, in case local file storage is not suitable for long-term retention.</p
  ><p
  >The ExecutionFileStorage service is used by two aspects of the Rundeck server currently.</p
  ><ol style="list-style-type: decimal;"
  ><li
    >Execution Log file - a data file containing all of the output for an execution</li
    ><li
    >Execution state files - a data file containing all of the workflow step and node state information for an execution</li
    ></ol
  ><div id="storage-behavior"
  ><h3
    ><a href="#TOC"
      >Storage behavior</a
      ></h3
    ><p
    >If an ExecutionFileStoragePlugin is installed and configured to be enabled, Rundeck will use it in this way after an Execution completes:</p
    ><p
    >Rundeck will place two <em
      >Storage Requests</em
      > in an asynchronous queue for that Execution to store the Log file and the State file.</p
    ><p
    >When triggered, the <em
      >Storage Request</em
      > will use the configured ExecutionFileStorage plugin and invoke <code
      >store</code
      >:</p
    ><ul
    ><li
      >If it is unsuccessful, Rundeck may re-queue the request to retry it after a delay (configurable)</li
      ></ul
    ></div
  ><div id="retrieval-behavior"
  ><h3
    ><a href="#TOC"
      >Retrieval behavior</a
      ></h3
    ><p
    >When a client requests a log stream to read via the <strong
      >Local File Log</strong
      >, or requests to read the <strong
      >Execution Workflow State</strong
      >, Rundeck determines if the file(s) are available locally. If they are not available, it will start a <em
      >Retrieval Request</em
      > asynchronously for each missing file, and tell the client that the file is in a &quot;pending&quot; state.</p
    ><p
    >The <em
      >Retrieval Request</em
      > will use the configured ExecutionFileStorage plugin, and invoke <code
      >retrieve</code
      >.</p
    ><p
    >If successful, the client requests to read the <strong
      >Local File Log</strong
      > or <strong
      >Execution Workflow State</strong
      > should find the file available locally. If unsuccessful, the result may be cached for a period of time to report to the client. After that time, a new <em
      >Retrieval Request</em
      > may be started if requested by a client. After a certain number of attempts fail, further attempts will be disabled and return the cached status. The retry delay and number of attempts can be configured.</p
    ></div
  ><div id="execution-file-availability"
  ><h3
    ><a href="#TOC"
      >Execution File Availability</a
      ></h3
    ><p
    >Your plugin will be asked if a file of a specific type is 'available', and should report back one of:</p
    ><ul
    ><li
      ><code
	>true</code
	> - the plugin can retrieve the file of the specified type</li
      ><li
      ><code
	>false</code
	> - the plugin cannot retrieve the file of the specified type</li
      ></ul
    ><p
    >Only if <code
      >true</code
      > is reported will a <em
      >Retrieval Request</em
      > be created.</p
    ><p
    >If there is an error discovering availability, your plugin should throw an Exception with the error message to report.</p
    ></div
  ><div id="java-executionfilestorage"
  ><h3
    ><a href="#TOC"
      >Java ExecutionFileStorage</a
      ></h3
    ><p
    >Create a Java class that implements the interface <a href="../javadoc/com/dtolabs/rundeck/plugins/logging/ExecutionFileStoragePlugin.html"
      >ExecutionFileStoragePlugin</a
      >:</p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> Plugin to implement {@link com<span class="Normal Symbol"
	>.</span
	>dtolabs<span class="Normal Symbol"
	>.</span
	>rundeck<span class="Normal Symbol"
	>.</span
	>core<span class="Normal Symbol"
	>.</span
	>logging<span class="Normal Symbol"
	>.</span
	>ExecutionFileStorage}<br
	 /> */<br
	 /><span class="Keyword"
	>public</span
	><span class="Normal NormalText"
	> </span
	><span class="Keyword"
	>interface</span
	><span class="Normal NormalText"
	> ExecutionFileStoragePlugin </span
	><span class="Keyword"
	>extends</span
	><span class="Normal NormalText"
	> ExecutionFileStorage </span
	><span class="Normal Symbol"
	>{</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	>/**<br
	 />     <span class="Normal Symbol"
	>*</span
	> Initializes the plugin with contextual data<br
	 />     <span class="Normal Symbol"
	>*</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>param context<br
	 />     */<br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Keyword"
	>public</span
	><span class="Normal NormalText"
	> </span
	><span class="DataType DataType"
	>void</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>initialize</span
	><span class="Normal Symbol"
	>(</span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal Symbol"
	>&lt;</span
	><span class="Normal Java15"
	>String</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Symbol"
	>?</span
	><span class="Normal NormalText"
	> </span
	><span class="Keyword"
	>extends</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Object</span
	><span class="Normal Symbol"
	>&gt;</span
	><span class="Normal NormalText"
	> context</span
	><span class="Normal Symbol"
	>);</span
	><br
	 /><br
	 /><span class="Normal NormalText"
	>    </span
	>/**<br
	 />     <span class="Normal Symbol"
	>*</span
	> Returns true if the file for the context and the given filetype <br
	 />     <span class="Normal Symbol"
	>*</span
	> is available<span class="Normal Symbol"
	>,</span
	> false otherwise<br
	 />     <span class="Normal Symbol"
	>*</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>param filetype file type or extension of the file to check<br
	 />     <span class="Normal Symbol"
	>*</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>return true if a file with the given filetype is available <br
	 />     <span class="Normal Symbol"
	>*</span
	> for the context<br
	 />     <span class="Normal Symbol"
	>*</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>throws com<span class="Normal Symbol"
	>.</span
	>dtolabs<span class="Normal Symbol"
	>.</span
	>rundeck<span class="Normal Symbol"
	>.</span
	>core<span class="Normal Symbol"
	>.</span
	>logging<span class="Normal Symbol"
	>.</span
	>ExecutionFileStorageException<br
	 />     <span class="Normal Symbol"
	>*</span
	>          if there is an error determining the availability<br
	 />     */<br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Keyword"
	>public</span
	><span class="Normal NormalText"
	> </span
	><span class="DataType DataType"
	>boolean</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>isAvailable</span
	><span class="Normal Symbol"
	>(</span
	><span class="Normal Java15"
	>String</span
	><span class="Normal NormalText"
	> filetype</span
	><span class="Normal Symbol"
	>)</span
	><span class="Normal NormalText"
	> </span
	><span class="Keyword"
	>throws</span
	><span class="Normal NormalText"
	> ExecutionFileStorageException</span
	><span class="Normal Symbol"
	>;</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    >This extends the interface <a href="../javadoc/com/dtolabs/rundeck/core/logging/ExecutionFileStorage.html"
      >ExecutionFileStorage</a
      >:</p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> Handles storage and retrieval of typed files for an execution<span class="Normal Symbol"
	>,</span
	> the filetype is specified in the {@link <span class="Normal NormalText"
	>#</span
	>store<span class="Normal Symbol"
	>(</span
	>String<span class="Normal Symbol"
	>,</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> java<span class="Normal Symbol"
	>.</span
	>io<span class="Normal Symbol"
	>.</span
	>InputStream<span class="Normal Symbol"
	>,</span
	> long<span class="Normal Symbol"
	>,</span
	> java<span class="Normal Symbol"
	>.</span
	>util<span class="Normal Symbol"
	>.</span
	>Date<span class="Normal Symbol"
	>)</span
	>} and {@link <span class="Normal NormalText"
	>#</span
	>retrieve<span class="Normal Symbol"
	>(</span
	>String<span class="Normal Symbol"
	>,</span
	> java<span class="Normal Symbol"
	>.</span
	>io<span class="Normal Symbol"
	>.</span
	>OutputStream<span class="Normal Symbol"
	>)</span
	>} methods<span class="Normal Symbol"
	>,</span
	> and more<br
	 /> <span class="Normal Symbol"
	>*</span
	> than one filetype may be stored or retrieved for the same execution<span class="Normal Symbol"
	>.</span
	><br
	 /> */<br
	 /><span class="Keyword"
	>public</span
	><span class="Normal NormalText"
	> </span
	><span class="Keyword"
	>interface</span
	><span class="Normal NormalText"
	> ExecutionFileStorage </span
	><span class="Normal Symbol"
	>{</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	>/**<br
	 />     <span class="Normal Symbol"
	>*</span
	> Stores a file of the given file type<span class="Normal Symbol"
	>,</span
	> read from the given stream<br
	 />     <span class="Normal Symbol"
	>*</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>param filetype     filetype or extension of the file to store<br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>param stream       the input stream<br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>param length       the file length<br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>param lastModified the file modification time<br
	 />     <span class="Normal Symbol"
	>*</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>return true if successful<br
	 />     <span class="Normal Symbol"
	>*</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>throws java<span class="Normal Symbol"
	>.</span
	>io<span class="Normal Symbol"
	>.</span
	>IOException<br
	 />     */<br
	 /><span class="Normal NormalText"
	>    </span
	><span class="DataType DataType"
	>boolean</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>store</span
	><span class="Normal Symbol"
	>(</span
	><span class="Normal Java15"
	>String</span
	><span class="Normal NormalText"
	> filetype</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>InputStream</span
	><span class="Normal NormalText"
	> stream</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><br
	 /><span class="Normal NormalText"
	>                  </span
	><span class="DataType DataType"
	>long</span
	><span class="Normal NormalText"
	> length</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Date</span
	><span class="Normal NormalText"
	> lastModified</span
	><span class="Normal Symbol"
	>)</span
	><span class="Normal NormalText"
	> </span
	><br
	 /><span class="Normal NormalText"
	>          </span
	><span class="Keyword"
	>throws</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>IOException</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> ExecutionFileStorageException</span
	><span class="Normal Symbol"
	>;</span
	><br
	 /><br
	 /><span class="Normal NormalText"
	>    </span
	>/**<br
	 />     <span class="Normal Symbol"
	>*</span
	> Write a file of the given file type to the given stream<br
	 />     <span class="Normal Symbol"
	>*</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>param filetype key to identify stored file<br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>param stream   the output stream<br
	 />     <span class="Normal Symbol"
	>*</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>return true if successful<br
	 />     <span class="Normal Symbol"
	>*</span
	><br
	 />     <span class="Normal Symbol"
	>*</span
	> <span class="Normal NormalText"
	>@</span
	>throws IOException<br
	 />     */<br
	 /><span class="Normal NormalText"
	>    </span
	><span class="DataType DataType"
	>boolean</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>retrieve</span
	><span class="Normal Symbol"
	>(</span
	><span class="Normal Java15"
	>String</span
	><span class="Normal NormalText"
	> filetype</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>OutputStream</span
	><span class="Normal NormalText"
	> stream</span
	><span class="Normal Symbol"
	>)</span
	><span class="Normal NormalText"
	> </span
	><br
	 /><span class="Normal NormalText"
	>       </span
	><span class="Keyword"
	>throws</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>IOException</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> ExecutionFileStorageException</span
	><span class="Normal Symbol"
	>;</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    >The plugin is used in these two conditions:</p
    ><ul
    ><li
      >A log or state file needs to be stored via the plugin</li
      ><li
      ><p
	>A log or state file needs to be retrieved via the plugin</p
	></li
      ><li
      >When the plugin is instantiated, any configuration properties defined that have values to be resolved are set on the plugin instance</li
      ><li
      ><p
	>The <code
	  >initialize</code
	  > method is called with a map of <a href="#execution-context-data"
	  >contextual data</a
	  > about the execution.</p
	></li
      ></ul
    ><p
    >When <code
      >retrieval</code
      > is needed:</p
    ><ol style="list-style-type: decimal;"
    ><li
      >The <code
	>isAvailable</code
	> method is called to determine if the plugin can retrieve the file, and the filetype is specified</li
      ><li
      >If the method returns true, then <code
	>retrieve</code
	> method is called with the same filetype.</li
      ></ol
    ><p
    >When <code
      >storage</code
      > is needed:</p
    ><ol style="list-style-type: decimal;"
    ><li
      >The <code
	>store</code
	> method is called with the filetype to store.</li
      ></ol
    ></div
  ><div id="groovy-executionfilestorage"
  ><h3
    ><a href="#TOC"
      >Groovy ExecutionFileStorage</a
      ></h3
    ><p
    >Create a groovy script that calls the <code
      >rundeckPlugin</code
      > method and passes the <code
      >ExecutionFileStoragePlugin</code
      > as the type of plugin:</p
    ><pre class="sourceCode java"
    ><code
      ><span class="Keyword"
	>import</span
	><span class="Normal NormalText"
	> com.dtolabs.rundeck.plugins.logging.ExecutionFileStoragePlugin</span
	><br
	 /><span class="Function"
	>rundeckPlugin</span
	><span class="Normal Symbol"
	>(</span
	><span class="Normal NormalText"
	>ExecutionFileStoragePlugin</span
	><span class="Normal Symbol"
	>){</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>//plugin definition</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    >To define metadata about your plugin, and configuration properties, see the <a href="notification-plugin.html#definition"
      >Notification Plugin - Groovy Notification Plugins - DSL - Definition</a
      > chapter.</p
    ><p
    >Define these closures inside your definition:</p
    ><p
    ><code
      >available</code
      ></p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> Called to determine the file availability<span class="Normal Symbol"
	>,</span
	> return true to indicate it is available<span class="Normal Symbol"
	>,</span
	> <br
	 /> <span class="Normal Symbol"
	>*</span
	> false to indicate it is not available<span class="Normal Symbol"
	>.</span
	> An exception indicates an error<span class="Normal Symbol"
	>.</span
	><br
	 /> */<br
	 /><span class="Normal NormalText"
	>available </span
	><span class="Normal Symbol"
	>{</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>String</span
	><span class="Normal NormalText"
	> filetype</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> execution</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> configuration</span
	><span class="Normal Symbol"
	>-&gt;</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>//determine state</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Keyword"
	>return</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>isAvailable</span
	><span class="Normal Symbol"
	>()</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    ><code
      >store</code
      ></p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> Called to store a log file<span class="Normal Symbol"
	>,</span
	> called with the execution data<span class="Normal Symbol"
	>,</span
	> configuration properties<span class="Normal Symbol"
	>,</span
	> and an InputStream<span class="Normal Symbol"
	>.</span
	>  Additionally <span class="Normal NormalText"
	>`</span
	>length<span class="Normal NormalText"
	>`</span
	> and <span class="Normal NormalText"
	>`</span
	>lastModified<span class="Normal NormalText"
	>`</span
	> properties are in the closure binding<span class="Normal Symbol"
	>,</span
	> providing the file length<span class="Normal Symbol"
	>,</span
	> and last modification Date<span class="Normal Symbol"
	>.</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> Return true to indicate success<span class="Normal Symbol"
	>.</span
	><br
	 /> */<br
	 /><span class="Normal NormalText"
	>store </span
	><span class="Normal Symbol"
	>{</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>String</span
	><span class="Normal NormalText"
	> filetype</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> execution</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> configuration</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>InputStream</span
	><span class="Normal NormalText"
	> source</span
	><span class="Normal Symbol"
	>-&gt;</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>//store output</span
	><br
	 /><span class="Normal NormalText"
	>    source</span
	><span class="Normal Symbol"
	>.</span
	><span class="Function"
	>withReader</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Symbol"
	>{</span
	><span class="Normal NormalText"
	> reader </span
	><span class="Normal Symbol"
	>-&gt;</span
	><br
	 /><span class="Normal NormalText"
	>        </span
	><span class="Comment"
	>//...write somewhere</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Normal Symbol"
	>}</span
	><br
	 /><span class="Normal NormalText"
	>    source</span
	><span class="Normal Symbol"
	>.</span
	><span class="Function"
	>close</span
	><span class="Normal Symbol"
	>()</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>//return true if successful</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Keyword"
	>true</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    ><code
      >retrieve</code
      ></p
    ><pre class="sourceCode java"
    ><code
      >/**<br
	 /> <span class="Normal Symbol"
	>*</span
	> Called to retrieve a log file<span class="Normal Symbol"
	>,</span
	> called with the execution data<span class="Normal Symbol"
	>,</span
	> configuration properties<span class="Normal Symbol"
	>,</span
	> and an OutputStream<span class="Normal Symbol"
	>.</span
	><br
	 /> <span class="Normal Symbol"
	>*</span
	> Return true to indicate success<span class="Normal Symbol"
	>.</span
	><br
	 /> */<br
	 /><span class="Normal NormalText"
	>retrieve </span
	><span class="Normal Symbol"
	>{</span
	><span class="Normal NormalText"
	>  </span
	><span class="Normal Java15"
	>String</span
	><span class="Normal NormalText"
	> filetype</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> execution</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>Map</span
	><span class="Normal NormalText"
	> configuration</span
	><span class="Normal Symbol"
	>,</span
	><span class="Normal NormalText"
	> </span
	><span class="Normal Java15"
	>OutputStream</span
	><span class="Normal NormalText"
	> out</span
	><span class="Normal Symbol"
	>-&gt;</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>//get log file contents and write to output stream</span
	><br
	 /><span class="Normal NormalText"
	>    out </span
	><span class="Normal Symbol"
	>&lt;&lt;</span
	><span class="Normal NormalText"
	> </span
	><span class="Function"
	>retrieveIt</span
	><span class="Normal Symbol"
	>()</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Comment"
	>//return true to indicate success</span
	><br
	 /><span class="Normal NormalText"
	>    </span
	><span class="Keyword"
	>true</span
	><br
	 /><span class="Normal Symbol"
	>}</span
	><br
	 /></code
      ></pre
    ><p
    >The plugin is used in this manner:</p
    ><ol style="list-style-type: decimal;"
    ><li
      >The <code
	>available</code
	> closure is called before retrieving the file, to determine if it is available, passing the filetype</li
      ><li
      >The <code
	>store</code
	> closure is called when a file needs to be stored, with the filetype, the <a href="#execution-context-data"
	>contextual data</a
	>, configuration Map, and InputStream which will produce the log data. Additionally <code
	>length</code
	> and <code
	>lastModified</code
	> properties are in the closure binding, providing the file length, and last modification Date.</li
      ><li
      >The <code
	>retrieve</code
	> closure is called when a file needs to be retrieved, with the <a href="#execution-context-data"
	>contextual data</a
	>, configuration Map, and OutputStream to write the log file content</li
      ></ol
    ></div
  ></div
>
</div>
</div>
</div>
</div>

<div class="container bottom breadcrumb_holder">
<div class="row">
<div class="col-sm-6">
<ol class="breadcrumb bottom">

    
        <li><a href="../index.html">Rundeck Documentation (2.1.0)</a></li>
    
    
    <li ><a href="index.html">Plugin Developer Guide</a></li>
    <li class="active"><a href="logging-plugin.html">Logging Plugin</a></li>
</ol>
</div>
<div class="col-sm-6">
    <ul class="pager">
      <li class="previous"><a href="storage-plugin.html"><i class="glyphicon glyphicon-arrow-left"></i> Storage Plugin</a></li>
      <li class="next"><a href="resource-model-source-plugin.html">Resource Model Source Plugin <i class="glyphicon glyphicon-arrow-right"></i></a></li>
    </ul>
</div>
</div>
</div>
<div class='container footer'>

<div class="row">
<footer class="copy col-sm-12 text-muted">

<span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">Rundeck Documentation</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://dtosolutions.com" property="cc:attributionName" rel="cc:attributionURL">SimplifyOps</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
<p>
&copy;2014 <a href="http://simplifyops.com">#SimplifyOps</a>
</p>
<p>
<span class="generated-date" title="2014-04-23T21:05:52EDT">2014-04-23T21:05:52EDT</span>
</p>
</footer>
</div>
</div>
<script type="text/javascript">
  

   var _gaq = [['_setAccount', 'UA-529275-13'], ['_trackPageview']];
   (function(d, t) {
    var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
    g.async = true;
    g.src = ('https:' == location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g, s);
   })(document, 'script');
  </script>
</body>
</html>

